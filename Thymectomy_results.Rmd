---
title: "Thymectomy"
output: github_document
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = paste0(dirname(inputFile),'/README.md')) })
---

<i>Analysis and visualization developed by [Oscar J. Ponce](https://twitter.com/PonceOJ), and project led by [Andrea Paola Solis-Pazmino](https://twitter.com/paosolpaz18)</i>


## Publication

To know more about the methodology, results and conclusion of this study follow the link below.

| Title      | Impact of the Surgical Approach to Thymectomy Upon Complete Stable Remission Rates in Myasthenia Gravis: A Meta-analysis |
| :--- | :---- |
| Journal      | Neurology       |
| Publication date | 4 May 2021 |
| DOI | [10.1212/WNL.0000000000012153](https://n.neurology.org/content/97/4/e357) |


## Podcast

The results of this study were also shared in the [Neurology® Podcast](https://podcasts.apple.com/us/podcast/impact-of-thymectomy-on-myasthenia-gravis-remission/id266288159?i=1000530091215)



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_chunk$set(dpi=900)
knitr::opts_chunk$set(fig.path = "Forestplots/", dev='svg') 

library("webshot")
library("metafor")
library("tidyverse")
library("rmarkdown")
library("magrittr")
library("forestplot")

```

 
```{r cleaning, echo=FALSE, message=FALSE, warning=FALSE}
pao <- read.csv("Data/thymectomy_outcomes.csv")

names(pao)[1] <- "refid"
names(pao)[2] <- "int"
names(pao)[3] <- "comp"
names(pao)[4] <- "group"
names(pao)[5] <- "outcome"
names(pao)[6] <- "followup"
names(pao)[7] <- "totaln"
names(pao)[8:11] <- c("n1","n2","events1","events2")
names(pao)[12:14] <- c("eff", "cill", "ciul")
names(pao)[15] <- "pvalue"
names(pao)[16] <- "app"
pao <- pao[,-(17)]


pao$group[pao$group == "Overall "] <- "Overall"

pao$int[pao$int %in% c("extended transsternal\r\nthymectomies", 
                       "Extended Transternal thymectomy",
                       "extended transsternal\nthymectomies",
                       "Extended median sternotomy")] <- "ETsT"
pao$int[pao$int == "Infrasternal mediastinoscopic thymectomy (IMT)"] <- "IMT"
pao$int[pao$int %in% c("transcervical-subxiphoidvideothoracoscopic\n‘maximal’ thymectomy", "transcervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy")] <- "TcSxVT"
pao$int[pao$int == "Transcervical thymectomy"] <- "BTcT"
pao$int[pao$int == "VATS unilateral alone"] <- 'VATS unilateral'
pao$int[pao$int == " VATET (bilateral)"] <- 'VATET bilateral'
pao$int[pao$int == " VATET (unilateral)"] <- 'VATET unilateral'
pao$int[pao$int == " VATS unilateral with robotic"] <- 'VATS unilateral with robotic'

pao$int[pao$int == "BTcT"] <- "T1a"
pao$int[pao$int == "VATS unilateral"] <- "T2a"
pao$int[pao$int == "VATS left"] <- "T2a left"
pao$int[pao$int == "VATET unilateral"] <- "T2b uni"
pao$int[pao$int == "VATET bilateral"] <- "T2b bi"
pao$int[pao$int == "VATS unilateral with robotic"] <- "T2c"
pao$int[pao$int == "ETsT"] <- "T3b"
pao$int[pao$int == "TcSxVT"] <- "T5a"
pao$int[pao$int == "IMT"] <- "T5d"


pao$comp[pao$comp %in% c("Extended median sternotomy", 
                         "Extended Transternal thymectomy")] <- "ETsT"
pao$comp[pao$comp %in% 
           c("\ntranscervical-subxiphoidvideothoracoscopic\n‘maximal’ thymectomy",
             "transcervical-subxiphoidvideothoracoscopic\n‘maximal’ thymectomy", 
             "transcervical-subxiphoidvideothoracoscopic\n‘maximal’ thymectomy\n", "\ntranscervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy ", "transcervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy\n", "transcervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy", "\ntranscervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy", "transcervical-subxiphoidvideothoracoscopic\n\x91maximal\x92 thymectomy")] <- "TcSxVT"
pao$comp[pao$comp == "basic transsternal\nthymectomies"] <- "STsT"
pao$comp[pao$comp == "VATS unilateral alone"] <- 'VATS unilateral'
pao$comp[pao$comp == " VATET (bilateral)"] <- 'VATET bilateral'
pao$comp[pao$comp == " VATS unilateral with robotic"] <- 'VATS unilateral with robotic'
pao$comp[pao$comp == "Anterolateral thoracotomy"] <- 'STsT'


pao$comp[pao$comp == "BTcT"] <- "T1a"
pao$comp[pao$comp == "VATS unilateral"] <- "T2a"
pao$comp[pao$comp == "VATS right"] <- "T2a right"
pao$comp[pao$comp == "VATET bilateral"] <- "T2b bi"
pao$comp[pao$comp == "VATS unilateral with robotic"] <- "T2c"
pao$comp[pao$comp == "STsT"] <- "T3a"
pao$comp[pao$comp == "ETsT"] <- "T3b"
pao$comp[pao$comp == "TcSxVT"] <- "T5a"



pao <- pao[c(1:62,66:67,63:65),]
row.names(pao) <- c(1:67)


#Changin direction of comparison for better interpretation
pao[63,] <- pao[63,c(1, 3, 2, 4:7, 9, 8, 11, 10,12:16)]
pao[c(43,46,49),] <- pao[c(43,46,49),c(1, 3, 2, 4:7, 9, 8, 11, 10,12:16)]


#round fucntion
round2 = function(x, n=0) {scale<-10^n; sign(x)*trunc(abs(x)*scale+0.5)/scale}
pao$events1 <- round2(pao$events1, 0)
pao$events2 <- round2(pao$events2, 0)


#creating author name based on refID
pao$author <- 
  ifelse(pao$refid==60, paste("Siwachat et al., 2016"),
  ifelse(pao$refid==130, paste("Xie et al., 2016"),
  ifelse(pao$refid==196, paste("Liu et al., 2015"),
  ifelse(pao$refid==257, paste("Chen et al., 2014"),
  ifelse(pao$refid==282, paste("Liu et al., 2013"),
  ifelse(pao$refid==340, paste("Huang et al., 2011"),
  ifelse(pao$refid==342, paste("Rucket et al., 2011"),
  ifelse(pao$refid==366, paste("Zielinski et al., 2010"),
  ifelse(pao$refid==377, paste("Lin et al., 2010"),
  ifelse(pao$refid==390, paste("Murai et al., 2009"),
  ifelse(pao$refid==592, paste("Zielinski et al., 2004"),
  ifelse(pao$refid==635, paste("Mantegazza et al., 2003"),
  ifelse(pao$refid==642, paste("Ruckert et al., 2003"),
  ifelse(pao$refid==1424, paste("Tomulescu et al., 2016"),
  ifelse(pao$refid==2416, paste("INCMNSZ, 2019"), NA )))))))))))))))

#Exclude RefID 592 because it enrolled patients that were enrolled for 366 
pao <- pao[!(pao$refid %in% 592),]
pao <- pao[!(pao$refid %in% 635),]


#Additional modifications
pao$int[pao$int == "T2a left"] <- "T2b left"

pao$comp[pao$comp == "T2a right"] <- "T2b right"
pao$int[pao$int == "T2b uni"] <- "T2b"

pao$comp[pao$comp == "T2b bi"] <- "T2b"
pao$int[pao$int == "T2b bi"] <- "T2b"


pao$comp[pao$comp == "T2a"] <- "T2b"
pao$int[pao$int == "T2a"] <- "T2b"

pao$comp <- ifelse(pao$refid==196, paste("T2b bi"), pao$comp)
pao$int <- ifelse(pao$refid==196, paste("T2b uni"), pao$int)



#Final paste
pao$comparison <- paste(pao$int, " vs. ", pao$comp)
```



## Open Data
>Click any of the following links to view the documents



| Stage  |      File     |  
|:----------:|:-------------:|
| Protocol | [Prospero](https://www.crd.york.ac.uk/prospero/display_record.php?RecordID=166827)|
| Search strategy | Available to download as `.CSV`: [OVID](https://github.com/ponceoscarj/Thymectomy/blob/master/1%20Search%20strategy/ovid_search.csv), [Scopus](https://github.com/ponceoscarj/Thymectomy/blob/master/1%20Search%20strategy/scopus_search.csv) |
| Abstract screening | [References used in this stage or search results](https://github.com/ponceoscarj/Thymectomy/blob/master/Screening_results/articles_for_abstract_screening.txt) |
| Full-text screening | [References used in this stage](https://github.com/ponceoscarj/Thymectomy/blob/master/Screening_results/articles_for_fulltext_screening.txt) |
| Included studies | [References used for data extraction](https://github.com/ponceoscarj/Thymectomy/blob/master/Screening_results/included_articles.txt) |
| Raw Outcome data | [Available as `.CSV`](https://github.com/ponceoscarj/Thymectomy/blob/master/Data/thymectomy_outcomes.csv)|
| Analysis codes | [Script as `R Markdown`](https://github.com/ponceoscarj/Thymectomy/blob/master/Thymectomy_results.Rmd)|



```{r overall_analysis, echo=FALSE}
prema1 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==3 & 
                            comparison=="T3b  vs.  T3a"), data=pao)
prema1 <- summary(prema1)
prema1$rr <- paste(formatC((exp(prema1$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema1$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema1$ci.ub)), format='f', digits=2),")")
ma1 <- rma(measure="RR", yi,vi, data=prema1, method="REML")
expma1 <- predict(ma1, transf = transf.exp.int)


prema2 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==4 & 
                            comparison=="T3b  vs.  T3a"), data=pao)
prema2 <- summary(prema2)
prema2$rr <- paste(formatC((exp(prema2$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema2$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema2$ci.ub)), format='f', digits=2),")")
ma2 <- rma(measure="RR", yi,vi, data=prema2, method="REML")
expma2 <- predict(ma2, transf = transf.exp.int)



prema3 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==5 & 
                            comparison=="T3b  vs.  T3a"), data=pao)
prema3 <- summary(prema3)
prema3$rr <- paste(formatC((exp(prema3$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema3$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema3$ci.ub)), format='f', digits=2),")")
ma3 <- rma(measure="RR", yi,vi, data=prema3, method="REML")
expma3 <- predict(ma3, transf = transf.exp.int)



ma4 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==10 & comparison=="T1a  vs.  T3b"),
            method="REML")
expma4 <- predict(ma4, transf = exp, digits=2)


ma5 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==3 & comparison=="T2b  vs.  T3a"), 
           method="REML")
expma5 <- predict(ma5, transf = exp, digits=2)


ma6 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==4 & comparison=="T2b  vs.  T3a"), 
           method="REML")
expma6<- predict(ma6, transf = exp, digits=2)


ma7 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==5 & comparison=="T2b  vs.  T3a"),
           method="REML")
expma7 <- predict(ma7, transf = exp, digits=2)


prema8 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==3 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema8 <- summary(prema8)
prema8$rr <- paste(formatC((exp(prema8$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema8$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema8$ci.ub)), format='f', digits=2),")")
ma8 <- rma(measure="RR", yi,vi, data=prema8, method="REML")
expma8 <- predict(ma8, transf = transf.exp.int)


prema9 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==4 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema9 <- summary(prema9)
prema9$rr <- paste(formatC((exp(prema9$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema9$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema9$ci.ub)), format='f', digits=2),")")
ma9 <- rma(measure="RR", yi,vi, data=prema9, method="REML")
expma9 <- predict(ma9, transf = transf.exp.int)


prema10 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==5 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema10 <- summary(prema10)
prema10$rr <- paste(formatC((exp(prema10$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema10$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema10$ci.ub)), format='f', digits=2),")")
ma10 <- rma(measure="RR", yi,vi, data=prema10, method="REML")
expma10 <- predict(ma10, transf = transf.exp.int)


prema11 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==6 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema11 <- summary(prema11)
prema11$rr <- paste(formatC((exp(prema11$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema11$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema11$ci.ub)), format='f', digits=2),")")
ma11 <- rma(measure="RR", yi,vi, data=prema11, method="REML")
expma11 <- predict(ma11, transf = transf.exp.int)


prema12 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==7 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema12 <- summary(prema12)
prema12$rr <- paste(formatC((exp(prema12$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema12$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema12$ci.ub)), format='f', digits=2),")")
ma12 <- rma(measure="RR", yi,vi, data=prema12, method="REML")
expma12 <- predict(ma12, transf = transf.exp.int)


prema13 <- escalc(measure="RR",ai=events1, ci=events2, n1i=n1, n2i=n2,
                  subset=(followup==8 & 
                            comparison=="T2b  vs.  T3b" & group=="Overall"), data=pao)
prema13 <- summary(prema13)
prema13$rr <- paste(formatC((exp(prema13$yi)), format='f', digits=2), " ",
                    "(", formatC((exp(prema13$ci.lb)), format='f', digits=2), "-",
                    formatC((exp(prema13$ci.ub)), format='f', digits=2),")")
ma13 <- rma(measure="RR", yi,vi, data=prema13, method="REML")
expma13 <- predict(ma13, transf = transf.exp.int)



ma14 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==9 & 
                                comparison=="T2b  vs.  T3b"),
            method="REML")
expma14 <- predict(ma14, transf = exp, digits=2)


ma24 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==3 & 
                                comparison=="T2b uni  vs.  T2b bi"),
            method="REML")
expma24 <- predict(ma24, transf = exp, digits=2)


ma25 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==4 & 
                                comparison=="T2b uni  vs.  T2b bi"),
            method="REML")
expma25 <- predict(ma25, transf = exp, digits=2)


ma26 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==5 & 
                                comparison=="T2b uni  vs.  T2b bi"),
            method="REML")
expma26 <- predict(ma26, transf = exp, digits=2)


ma27 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==6 & 
                                comparison=="T2b uni  vs.  T2b bi"),
            method="REML")
expma27 <- predict(ma27, transf = exp, digits=2)

ma28 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==3 & comparison=="T2b left  vs.  T2b right"),
            method="REML")
expma28 <- predict(ma28, transf = exp, digits=2)


ma29 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==4 & comparison=="T2b left  vs.  T2b right"),
            method="REML")
expma29 <- predict(ma29, transf = exp, digits=2)


ma30 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==3 & 
                                comparison=="T2c  vs.  T2b"),
            method="REML")
expma30 <- predict(ma30, transf = exp, digits=2)


ma31 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==5 & 
                                comparison=="T2c  vs.  T2b"),
            method="REML")
expma31 <- predict(ma31, transf = exp, digits=2)



ma32 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==3 & comparison=="T5a  vs.  T3a"),
           method="REML")
expma32 <- predict(ma32, transf = exp, digits=2)


ma33 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==4 & comparison=="T5a  vs.  T3a"), 
           method="REML")
expma33 <- predict(ma33, transf = exp, digits=2)


ma34 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==5 & comparison=="T5a  vs.  T3a"), 
           method="REML")
expma34 <-predict(ma34, transf = exp, digits=2)


ma35 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==3 & comparison=="T5a  vs.  T3b"),
           method="REML")
expma35 <- predict(ma35, transf = exp, digits=2)


ma36 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==4 & comparison=="T5a  vs.  T3b"), 
           method="REML")
expma36 <- predict(ma36, transf = exp, digits=2)


ma37 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
           data=pao, subset=(followup==5 & comparison=="T5a  vs.  T3b"), 
           method="REML")
expma37 <- predict(ma37, transf = exp, digits=2)


ma38 <- rma(measure="RR", ai=events1, ci=events2, n1i=n1, n2i=n2, 
            data=pao, subset=(followup==5 & comparison=="T5d  vs.  T3b"), 
            method="REML")
expma38 <- predict(ma38, transf = exp, digits=2)
```



```{r organization_summary, echo=FALSE}
head <- c("comparison",  "followup", "k", "ai", "bi",
                     "ci", "di", "i2", "eff", "llci", "ulci","p")

a<- rbind(
  c("T3b  vs.  T3a",  "3 years",  ma1$k.eff, 
  sum(prema1$events1), (sum(prema1$n1)-sum(prema1$events1)),
  sum(prema1$events2), (sum(prema1$n2)-sum(prema1$events2)), 
  ma1$I2, expma1$pred, expma1$ci.lb, expma1$ci.ub,
  ma1$pval), 
  c("T3b  vs.  T3a",  "4 years", ma2$k.eff, 
  sum(prema2$events1), (sum(prema2$n1)-sum(prema2$events1)),
  sum(prema2$events2), (sum(prema2$n2)-sum(prema2$events2)), 
  ma2$I2, expma2$pred, expma2$ci.lb, expma2$ci.ub,
  ma2$pval), 
  c("T3b  vs.  T3a", "5 years", ma3$k.eff, 
  sum(prema3$events1), (sum(prema3$n1)-sum(prema3$events1)),
  sum(prema3$events2), (sum(prema3$n2)-sum(prema3$events2)), 
   ma3$I2, expma3$pred, expma3$ci.lb, expma3$ci.ub,
  ma3$pval))




b <-  c("T1a  vs.  T3b",  "10 years", ma4$k.eff, 
  sum(ma4$ai.f), sum(ma4$bi.f),
  sum(ma4$ci.f), sum(ma4$di.f), 
   ma4$I2, expma4$pred, expma4$ci.lb, expma4$ci.ub,
  ma4$pval)



c <- rbind(
  c("T2b  vs.  T3a",  "3 years", ma4$k.eff, 
  sum(ma4$ai.f), sum(ma4$bi.f),
  sum(ma4$ci.f), sum(ma4$di.f), 
   ma4$I2, expma4$pred, expma4$ci.lb, expma4$ci.ub,
  ma4$pval), 
  c("T2b  vs.  T3a",  "4 years", ma5$k.eff, 
  sum(ma5$ai.f), sum(ma5$bi.f),
  sum(ma5$ci.f), sum(ma5$di.f), 
   ma5$I2, expma5$pred, expma5$ci.lb, expma5$ci.ub,
  ma5$pval),
  c("T2b  vs.  T3a", "5 years", ma6$k.eff, 
  sum(ma6$ai.f), sum(ma6$bi.f),
  sum(ma6$ci.f), sum(ma6$di.f), 
   ma6$I2, expma6$pred, expma6$ci.lb, expma6$ci.ub,
  ma6$pval))
  

d <- rbind(
  c("T2b  vs.  T3b", "3 years", ma8$k.eff, 
  sum(prema8$events1), (sum(prema8$n1)-sum(prema8$events1)),
  sum(prema8$events2), (sum(prema8$n2)-sum(prema8$events2)), 
   ma8$I2, expma8$pred, expma8$ci.lb, expma8$ci.ub,
  ma8$pval),
  c("T2b  vs.  T3b", "4 years", ma9$k.eff, 
  sum(prema9$events1), (sum(prema9$n1)-sum(prema9$events1)),
  sum(prema9$events2), (sum(prema9$n2)-sum(prema9$events2)), 
   ma9$I2, expma9$pred, expma9$ci.lb, expma9$ci.ub,
  ma9$pval),
  c("T2b  vs.  T3b", "5 years", ma10$k.eff, 
  sum(prema10$events1), (sum(prema10$n1)-sum(prema10$events1)),
  sum(prema10$events2), (sum(prema10$n2)-sum(prema10$events2)), 
   ma10$I2, expma10$pred, expma10$ci.lb, expma10$ci.ub,
  ma10$pval),
  c("T2b  vs.  T3b", "6 years", ma11$k.eff, 
  sum(prema11$events1), (sum(prema11$n1)-sum(prema11$events1)),
  sum(prema11$events2), (sum(prema11$n2)-sum(prema11$events2)), 
   ma11$I2, expma11$pred, expma11$ci.lb, expma11$ci.ub,
  ma11$pval),
  c("T2b  vs.  T3b", "7 years", ma12$k.eff, 
  sum(prema12$events1), (sum(prema12$n1)-sum(prema12$events1)),
  sum(prema12$events2), (sum(prema12$n2)-sum(prema12$events2)), 
   ma12$I2, expma12$pred, expma12$ci.lb, expma12$ci.ub,
  ma12$pval),
  c("T2b  vs.  T3b", "8 years", ma13$k.eff, 
  sum(prema13$events1), (sum(prema13$n1)-sum(prema13$events1)),
  sum(prema13$events2), (sum(prema13$n2)-sum(prema13$events2)), 
   ma13$I2, expma13$pred, expma13$ci.lb, expma13$ci.ub,
  ma13$pval),
  c("T2b  vs.  T3b", "9 years", ma14$k.eff, 
  sum(ma14$ai.f), sum(ma14$bi.f),
  sum(ma14$ci.f), sum(ma14$di.f), 
   ma14$I2, expma14$pred, expma14$ci.lb, expma14$ci.ub,
  ma14$pval))




g <- rbind(
  c("T2b uni  vs.  T2b bi", "3 years", ma24$k.eff, 
  sum(ma24$ai.f), sum(ma24$bi.f),
  sum(ma24$ci.f), sum(ma24$di.f), 
   ma24$I2, expma24$pred, expma24$ci.lb, expma24$ci.ub,
  ma24$pval),
  c("T2b uni  vs.  T2b bi", "4 years", ma25$k.eff, 
  sum(ma25$ai.f), sum(ma25$bi.f),
  sum(ma25$ci.f), sum(ma25$di.f), 
   ma25$I2, expma25$pred, expma25$ci.lb, expma25$ci.ub,
  ma25$pval),
  c("T2b uni  vs.  T2b bi", "5 years", ma26$k.eff, 
  sum(ma26$ai.f), sum(ma26$bi.f),
  sum(ma26$ci.f), sum(ma26$di.f), 
   ma26$I2, expma26$pred, expma26$ci.lb, expma26$ci.ub,
  ma26$pval),
  c("T2b uni  vs.  T2b bi", "6 years", ma27$k.eff, 
  sum(ma27$ai.f), sum(ma27$bi.f),
  sum(ma27$ci.f), sum(ma27$di.f), 
   ma27$I2, expma27$pred, expma27$ci.lb, expma27$ci.ub,
  ma27$pval))




h <- rbind(
  c("T2b left  vs.  T2b right", "3 years", ma28$k.eff, 
  sum(ma28$ai.f), sum(ma28$bi.f),
  sum(ma28$ci.f), sum(ma28$di.f), 
   ma28$I2, expma28$pred, expma28$ci.lb, expma28$ci.ub,
  ma28$pval),
  c("T2b left  vs.  T2b right", "4 years", ma29$k.eff, 
  sum(ma29$ai.f), sum(ma29$bi.f),
  sum(ma29$ci.f), sum(ma29$di.f), 
   ma29$I2, expma29$pred, expma29$ci.lb, expma29$ci.ub,
  ma29$pval))

i <- rbind(
  c("T2c  vs.  T2b", "3 years", ma30$k.eff, 
  sum(ma30$ai.f), sum(ma30$bi.f),
  sum(ma30$ci.f), sum(ma30$di.f), 
   ma30$I2, expma30$pred, expma30$ci.lb, expma30$ci.ub,
  ma30$pval),
  c("T2c  vs.  T2b", "5 years", ma31$k.eff, 
  sum(ma31$ai.f), sum(ma31$bi.f),
  sum(ma31$ci.f), sum(ma31$di.f), 
   ma31$I2, expma31$pred, expma31$ci.lb, expma31$ci.ub,
  ma31$pval))


j <- rbind(
  c("T5a  vs.  T3a", "3 years", ma32$k.eff, 
  sum(ma32$ai.f), sum(ma32$bi.f),
  sum(ma32$ci.f), sum(ma32$di.f), 
   ma32$I2, expma32$pred, expma32$ci.lb, expma32$ci.ub,
  ma32$pval),
  c("T5a  vs.  T3a", "4 years", ma33$k.eff, 
  sum(ma33$ai.f), sum(ma33$bi.f),
  sum(ma33$ci.f), sum(ma33$di.f), 
   ma33$I2, expma33$pred, expma33$ci.lb, expma33$ci.ub,
  ma33$pval), 
  c("T5a  vs.  T3a", "5 years", ma34$k.eff, 
  sum(ma34$ai.f), sum(ma34$bi.f),
  sum(ma34$ci.f), sum(ma34$di.f), 
   ma34$I2, expma34$pred, expma34$ci.lb, expma34$ci.ub,
  ma34$pval))


k <- rbind(
  c("T5a  vs.  T3b", "3 years", ma35$k.eff, 
  sum(ma35$ai.f), sum(ma35$bi.f),
  sum(ma35$ci.f), sum(ma35$di.f), 
   ma35$I2, expma35$pred, expma35$ci.lb, expma35$ci.ub,
  ma35$pval),
  c("T5a  vs.  T3b", "4 years", ma36$k.eff, 
  sum(ma36$ai.f), sum(ma36$bi.f),
  sum(ma36$ci.f), sum(ma36$di.f), 
   ma36$I2, expma36$pred, expma36$ci.lb, expma36$ci.ub,
  ma36$pval), 
  c("T5a  vs.  T3b", "5 years", ma37$k.eff, 
  sum(ma37$ai.f), sum(ma37$bi.f),
  sum(ma37$ci.f), sum(ma37$di.f), 
   ma37$I2, expma37$pred, expma37$ci.lb, expma37$ci.ub,
  ma37$pval))

l <- c("T5d  vs.  T3b", "5 years", ma38$k.eff, 
  sum(ma38$ai.f), sum(ma38$bi.f),
  sum(ma38$ci.f), sum(ma38$di.f), 
   ma38$I2, expma38$pred, expma38$ci.lb, expma38$ci.ub,
  ma38$pval)



summarybefore <- rbind(
  c("a", "T3b  vs.  T3a"),
  c("b", "T3b  vs.  T1a"),
  c("c", "T3a  vs.  T2b"),
  c("d", "T3b  vs.  T2b"),
  c("g", "T2b uni  vs.  T2b bi"),
  c("h", "T2b left  vs.  T2b right"),
  c("i", "T2c  vs.  T2b"),
  c("j", "T3a  vs.  T5a"),
  c("k", "T3b  vs.  T5a"),
  c("l", "T3b  vs.  T5d"))

summaryafter <- rbind(
  c("a", "T3b  vs.  T3a"),
  c("b", "T1a  vs.  T3b"),
  c("c", "T2b  vs.  T3a"),
  c("d", "T2b  vs.  T3b"),
  c("g", "T2b uni  vs.  T2b bi"),
  c("h", "T2b left  vs.  T2b right"),
  c("i", "T2c  vs.  T2b"),
  c("j", "T5a  vs.  T3a"),
  c("k", "T5a  vs.  T3b"),
  c("l", "T5d  vs.  T3b"))


```



## Summary of forest plots

### Figure 2 
<details><summary>Click to show</summary>

*Risk of achieving Complete Stable Remission in patients with myasthenia gravis who underwent* ***Extended transsternal thymectomy***  *vs.*  ***Transsternal thymectomy*** *at different follow-ups*

```{r,  fig.height=3, fig.width=13, echo=FALSE, message=FALSE, warning=FALSE}
agr <- as_tibble(a)
colnames(agr) <- head
agr[,c(3:7,8:12)] <- sapply(agr[,c(3:7,8:12)], as.numeric)
agr$i2 <- ifelse(agr$k==1, "na", formatC(round2(agr$i2), format='f', digits=0))
agr$rr <- paste(formatC(round2(agr$eff, n=2), format='f', digits=2), 
                "(", formatC(round2(agr$llci, n=2), format='f', digits=2),
                "-", formatC(round2(agr$ulci, n=2), format='f', digits=2),
                ")")
agr$n1 <- (agr$ai + agr$bi)
agr$n2 <- (agr$ci + agr$di)
agr$rate1 <- paste(agr$ai,"/",agr$n1)
agr$rate2 <- paste(agr$ci,"/",agr$n2)


agr$p2 <- 
  ifelse(is.na(agr$p), NA, 
  ifelse(agr$p<0.001, paste("<0.001"), 
         paste(formatC(round2(agr$p,n=3), format='f', digits=3))))


agr <- agr %>% add_row(followup="Extended Transsternal vs. Basic Transsternal", .before = 1)
agr <- agr %>% add_row(.before =  1)
agr <- agr %>% add_row(.after =  5)


agr2 <- cbind(c("Treatment vs. Control", "Follow-up",agr$followup),
              c("N of studies", NA, agr$k),
              c("Treatment", "events/n", agr$rate1),
              c("Control", "events/n", agr$rate2),
              c("I^2", NA, agr$i2),
              c("Relative Risk (95% CI)", NA, agr$rr),
              c("p value", NA, agr$p2))
sub1 <- c(5:7)
agr2[,1][sub1] <- paste("  ",agr2[,1][sub1])

rrsagr <- structure(list(
  mean = c(NA, NA, agr$eff),
  lower = c(NA, NA, agr$llci),
  upper = c(NA, NA, agr$ulci)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -6L),
  class = "data.frame")

forestplot(agr2,
           rrsagr,
           graph.pos = 6,
           zero=1,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:8), col="black")),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           is.summary = c(T, T, F, 
                          T, rep(F, 3), F),
           align = c("l","c", "c", "c", "l", "l", "l"),
           boxsize = 0.5,
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.9), 
                            ticks = gpar(cex = 0.9, fontface="bold"),
                            summary = gpar(cex = 0.9),
                            xlab = gpar(cex=0.9)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))

```


> To generate this forest plot, we used information from Supplementary Figures 1 to 3.

</details>


### Figure 3
<details><summary>Click to show</summary>

*Risk of achieving Complete Stable Remission in patients with myasthenia gravis who underwent* ***Transsternal  Thymectomy*** *vs.* ***Minimally Invasive Thymectomy*** *at different follow-ups*
```{r, fig.height=7, fig.width=19, echo=FALSE, message=FALSE, warning=FALSE}
lessagr <- as_tibble(rbind(c, d, j, k,  l, b))
colnames(lessagr) <- head

lessagr[,c(3:8,9:12)] <- sapply(lessagr[,c(3:8,9:12)], as.numeric)
lessagr$i2 <- ifelse(lessagr$k==1, "na", 
                     paste(formatC(round2(lessagr$i2,n=0), format='f',digits=0), "%"))
lessagr$rr <- paste(formatC(round2(lessagr$eff, n=2), format='f', digits=2), 
                "(", formatC(round2(lessagr$llci, n=2), format='f', digits=2),
                "-", formatC(round2(lessagr$ulci, n=2), format='f', digits=2),
                ")")
lessagr$n1 <- (lessagr$ai + lessagr$bi)
lessagr$n2 <- (lessagr$ci + lessagr$di)
lessagr$rate1 <- paste(lessagr$ai,"/",lessagr$n1)
lessagr$rate2 <- paste(lessagr$ci,"/",lessagr$n2)
lessagr$p2 <- 
  ifelse(is.na(lessagr$p), NA, 
  ifelse(lessagr$p<0.001, paste("<0.001"), 
         paste(formatC(round2(lessagr$p,n=3), format='f', digits=3))))

lessagr <- lessagr %>% add_row(followup="VATS extended vs. Basic Transsternal ", .before = 1)
lessagr <- lessagr %>% add_row(followup="VATS extended vs. Extended Transsternal", .before = 5)
lessagr <- lessagr %>% add_row(followup="Combined Transcervical-Subxiphoid vs. Basic Transsternal", .before = 13)
lessagr <- lessagr %>% add_row(followup="Extended Transsternal vs. Combined Transcervical-Subxiphoid", .before = 17)
lessagr <- lessagr %>% add_row(followup="Subxiphoid Mediastinoscopy vs. Extended Transsternal", .before = 21)
lessagr <- lessagr %>% add_row(followup="Extended Transcervical vs. Extended Transsternal", .before = 23)

lessagr <- lessagr %>% add_row(.before = 1)
lessagr <- lessagr %>% add_row(.after = 25)


lessagr2 <- cbind(c("Treatment vs. Control", "Follow-up",lessagr$followup),
              c("N of studies", NA, lessagr$k),
              c("Treatment", "events/n", lessagr$rate1),
              c("Control", "events/n", lessagr$rate2),
              c("I^2", NA, lessagr$i2),
              c("Relative Risk (95% CI)", NA, lessagr$rr),
              c("p value", NA, lessagr$p2))


sub1 <- c(5:7, 9:15, 17:19, 21:23, 25, 27)
lessagr2[,1][sub1] <- paste("  ",lessagr2[,1][sub1])

rrslessagr <- structure(list(
  mean = c(NA, NA, lessagr$eff),
  lower = c(NA, NA, lessagr$llci),
  upper = c(NA, NA, lessagr$ulci)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -28L),
  class = "data.frame")


forestplot(lessagr2,
           graph.pos = 6,
           zero=1,
           rrslessagr,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:8), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           is.summary = c(T, T, F, 
                          T, rep(F, 3),
                          T, rep(F, 7), 
                          T, rep(F, 3), 
                          T, rep(F, 3), 
                          T, rep(F, 1), T, F, F),
           align = c("l","c", "c", "c", "l", "l", "l"),
           boxsize = 0.5,
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=1), 
                            ticks = gpar(cex = 1, fontface="bold"),
                            summary = gpar(cex = 1),
                            xlab = gpar(cex=0.9)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(18,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))

```

> To generate this forest plot, we used information from Supplementary Figures 4 to 9.

</details>


### Figure 4
<details><summary>Click to show</summary>

*Risk of achieving Complete Stable Remission in patients with myasthenia gravis who underwent* ***different types of minimally invasive thymectomy*** *at different follow-ups*


```{r,  fig.height=3, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
less <- as_tibble(rbind(h, i))
colnames(less) <- head

less[,c(3:8,9:12)] <- sapply(less[,c(3:8,9:12)], as.numeric)
less$i2 <- ifelse(less$k==1, "na", paste(formatC(round2(less$i2,n=0), format='f',digits=0),"%"))
less$rr <- paste(formatC(round2(less$eff, n=2), format='f', digits=2), 
                "(", formatC(round2(less$llci, n=2), format='f', digits=2),
                "-", formatC(round2(less$ulci, n=2), format='f', digits=2),
                ")")
less$n1 <- (less$ai + less$bi)
less$n2 <- (less$ci + less$di)
less$rate1 <- paste(less$ai,"/",less$n1)
less$rate2 <- paste(less$ci,"/",less$n2)
less$p2 <- 
  ifelse(is.na(less$p), NA, 
  ifelse(less$p<0.001, paste("<0.001"), 
         paste(formatC(round2(less$p,n=3), format='f', digits=3))))



less <- less %>% add_row(followup="VATS extended left vs. VATS extended right", .before = 1)
less <- less %>% add_row(followup="VATS extended with robotic  vs. VATS extended", .before = 4)

less <- less %>% add_row(.before = 1)
less <- less %>% add_row(.after = 7)


less2 <- cbind(c("Treatment vs. Control", "Follow-up",less$followup),
              c("N of studies", NA, less$k),
              c("Treatment", "events/n", less$rate1),
              c("Control", "events/n", less$rate2),
              c("I^2", NA, less$i2),
              c("Relative Risk (95% CI)", NA, less$rr),
              c("p value", NA, less$p2))

sub1 <- c(5,6,8,9)
less2[,1][sub1] <- paste("  ",less2[,1][sub1])


rrsless <- structure(list(
  mean = c(NA, NA, less$eff),
  lower = c(NA, NA, less$llci),
  upper = c(NA, NA, less$ulci)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -10L),
  class = "data.frame")


forestplot(less2,
           graph.pos = 6,
           zero=1,
           rrsless,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:8), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           is.summary = c(T, T, F, 
                          T, rep(F, 2), 
                          T, rep(F,2), 
                          F),
           align = c("l","c", "c", "c", "l", "l", "l"),
           boxsize = 0.5,
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.9), 
                            ticks = gpar(cex = 0.9, fontface="bold"),
                            summary = gpar(cex = 0.9),
                            xlab = gpar(cex=0.9)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(9,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))

```
</details>


### Figure 5
<details><summary>Click to show</summary>

*Risk of achieving Complete Stable Remission in patients with myasthenia gravis who underwent* ***VATS extended unilateral*** *vs. those who underwent* ***VATS extended bilateral*** *thymectomy at different follow-ups*

```{r,  fig.height=3, fig.width=14, echo=FALSE, message=FALSE, warning=FALSE}
less3 <- as_tibble(rbind(g))
colnames(less3) <- head

less3[,c(3:8,9:12)] <- sapply(less3[,c(3:8,9:12)], as.numeric)
less3$i2 <- ifelse(less3$k==1, "na", paste(formatC(round2(less3$i2,n=0), format='f',digits=0),"%"))
less3$rr <- paste(formatC(round2(less3$eff, n=2), format='f', digits=2), 
                "(", formatC(round2(less3$llci, n=2), format='f', digits=2),
                "-", formatC(round2(less3$ulci, n=2), format='f', digits=2),
                ")")
less3$n1 <- (less3$ai + less3$bi)
less3$n2 <- (less3$ci + less3$di)
less3$rate1 <- paste(less3$ai,"/",less3$n1)
less3$rate2 <- paste(less3$ci,"/",less3$n2)
less3$p2 <- 
  ifelse(is.na(less3$p), NA, 
  ifelse(less3$p<0.001, paste("<0.001"), 
         paste(formatC(round2(less3$p,n=3), format='f', digits=3))))



less3 <- less3 %>% add_row(followup="VATS extended uni vs. VATS extended bi", .before = 1)

less3 <- less3 %>% add_row(.before = 1)
less3 <- less3 %>% add_row(.after = 6)


less4 <- cbind(c("Treatment vs. Control", "Follow-up",less3$followup),
              c("N of studies", NA, less3$k),
              c("Treatment", "events/n", less3$rate1),
              c("Control", "events/n", less3$rate2),
              c("I^2", NA, less3$i2),
              c("Relative Risk (95% CI)", NA, less3$rr),
              c("p value", NA, less3$p2))

sub1 <- c(5:8)
less4[,1][sub1] <- paste("  ",less4[,1][sub1])


rrsless <- structure(list(
  mean = c(NA, NA, less3$eff),
  lower = c(NA, NA, less3$llci),
  upper = c(NA, NA, less3$ulci)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -9L),
  class = "data.frame")


forestplot(less4,
           graph.pos = 6,
           zero=1,
           rrsless,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:8), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           is.summary = c(T, T, F, 
                          T, rep(F, 4), 
                          F),
           align = c("l","c", "c", "c", "l", "l", "l"),
           boxsize = 0.5,
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.9), 
                            ticks = gpar(cex = 0.9, fontface="bold"),
                            summary = gpar(cex = 0.9),
                            xlab = gpar(cex=0.9)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(9,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))

```
</details>


```{r complications, echo=FALSE, fig.height=3, fig.width=10, message=FALSE, warning=FALSE}
rr <- function(database, e1, e2){
  db <- database
  db <- escalc(measure="RR", ai=e1, ci=e2, n1i=n1, n2i=n2,data=database)
  db <- db[order(db$yi),]
  db <- summary(db)
  
  db$est <-  exp(db$yi)
  db$ci.lb <- exp(db$ci.lb)
  db$ci.ub <- exp(db$ci.ub)
  
  
  db$rate1 <- paste(e1,"/",db$n1)
  db$rate2 <- paste(e2,"/",db$n2)
  db$rr <- paste(formatC(db$est, format='f', digits =2)," ",
                 "(",formatC(db$ci.lb, format='f', digits =2),
                 "-",formatC(db$ci.ub, format='f', digits=2),")")  
  
  ma <- rma(db$yi, db$vi, measure='RR', data=db, method='REML')
  exp <- predict(ma, transf = transf.exp.int)
  
  db$weights <- weights(ma)
  db$w <- paste(formatC(db$weights, format='f', digits = 1),'%')
  
  
  list(pre = db, ma = ma, exp = exp)
}


table_rr <- function(analysis, int, comp, outcome, nstudies, e1, e2){
  ifelse(nstudies>1,
  b <- cbind( 
    c("Author", analysis$pre$author, 
      paste("Overall Relative Risk for", analysis$ma$k, "studies","\n", 
            "(Tau^2 = ", (formatC(analysis$ma$tau2, digits=2, format="f")), ", df = ", 
            (analysis$ma$k - analysis$ma$p),
            ", p ", (ifelse(analysis$ma$QEp < 0.001, 
                            paste("< 0.001"),
                            paste("= ", formatC(analysis$ma$QEp, digits=3, format="f")))),
            "; ", "I^2", " = ", (formatC(analysis$ma$I2, digits=1, format="f")), "%)")),
    c(paste(int, '\n', outcome,'/','total n'),analysis$pre$rate1, paste(sum(e1), " / ",
                                                      sum(analysis$pre$n1))),
    c(paste(comp, '\n', outcome,'/', 'total n'),analysis$pre$rate2, paste(sum(e2), " / ",
                                                        sum(analysis$pre$n2))),
    c("Relative Risk (95% CI)", analysis$pre$rr, 
      paste(formatC(analysis$exp$pred, format='f', digits =2), 
            " (",formatC(analysis$exp$ci.lb, format='f', digits=2),
            "-", formatC(analysis$exp$ci.ub, format='f', digits=2), ")")),
    c("Weight(%)", paste(formatC(weights(analysis$ma), format='f', digits = 1),'%'), NA)),
       b <- cbind( 
        c("Author", analysis$pre$author),
        c(paste(int, '\n', outcome,'/','total n'),analysis$pre$rate1),
        c(paste(comp, '\n', outcome,'/', 'total n'),analysis$pre$rate2),
        c("Relative Risk (95% CI)", analysis$pre$rr)))
  
  b <- as_tibble(b, .name_repair = "unique")
  b <- b %>% add_row(.before = 2)
  b <- b %>% add_row(.before = 2)
  b <- b %>% add_row(.after = nrow(b))  
  
  ifelse(nstudies>1, b <- b %>% add_row(.before = nrow(b)-1), NA)

  
  ifelse(nstudies > 1,
        (c <- structure(list(
          mean = c(rep(NA, 3), analysis$pre$est, NA, analysis$exp$pred,NA),
          lower = c(rep(NA, 3), analysis$pre$ci.lb, NA, analysis$exp$ci.lb, NA),
          upper = c(rep(NA, 3), analysis$pre$ci.ub, NA, analysis$exp$ci.ub, NA)),
          .Names = c("mean", "lower", "upper"),
          row.names = c(NA, -1L*nrow(b)),
          class = "data.frame")),
        (c <- structure(list(
          mean = c(rep(NA, 3), analysis$pre$est, NA),
          lower = c(rep(NA, 3), analysis$pre$ci.lb, NA),
          upper = c(rep(NA, 3), analysis$pre$ci.ub, NA)),
          .Names = c("mean", "lower", "upper"),
          row.names = c(NA, -1L*nrow(b)),
          class = "data.frame")))

  c <- as_tibble(c)
  
  list(b = b, c = c)
} 
  
  
  




plotrr_single_studies <- function(words, numbers, xtick, sizes, 
                                  bolding, aligning, fpPosition){
  
  forestplot(words,
             graph.pos = fpPosition,
             zero = 1,
             numbers,
             new_page = TRUE,
             colgap = unit(5, "mm"),
             hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:(ncol(words)+1)), col="black")),
             lineheight=unit(0.7,'cm'),
             boxsize = sizes,
             line.margin = 2,
             is.summary = bolding,
             align = aligning,
             ci.vertices = TRUE,
             txt_gp = fpTxtGp(label =gpar (cex=0.9), 
                              ticks = gpar(cex = 0.9, fontface="bold"),
                              summary = gpar(cex = 0.9),
                              xlab = gpar(cex=0.9)),
             xticks = xtick,
             xlog=TRUE,
             clip = c(0.2, 32),
             grid = xtick,
             lwd.xaxis = 1,
             lwd.ci = 2.2,
             lwd.zero = 2,
             graphwidth = unit(10,"cm"),
             col=fpColors(box="black",line="grey", zero = 'dodgerblue4', axes="grey20", summary="black"))
  
  
}  


comp <- read.csv("Data/complications.csv")

comp$versus <- paste0(comp$intervention, ' vs. ', comp$comparison)
names(comp)[3] <- "int"
names(comp)[5] <- "comp"


comp2 <- subset(comp, versus=='VATS extended vs. Basic transsternal')

comp2_winf <- rr(comp2, e1 = comp2$winf1, e2=comp2$winf2)
tcomp2_winf <- table_rr(comp2_winf,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Wound Infection',
                      e1 = comp2_winf$pre$winf1, e2 = comp2_winf$pre$winf2)


comp3 <- subset(comp, versus=='VATS extended vs. Extended transsternal')

comp3_pn <- subset(comp3, !is.na(comp3$pn1))
comp3_pn <- rr(comp3_pn, e1 = comp3_pn$pn1, e2=comp3_pn$pn2)
tcomp3_pn <- table_rr(comp3_pn,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 6, outcome = 'Pneumonia',
                       e1 = comp3_pn$pre$pn1, e2 = comp3_pn$pre$pn2)

comp3_mya <- subset(comp3, !is.na(comp3$mya1))
comp3_mya <- rr(comp3_mya,e1 = comp3_mya$mya1, e2=comp3_mya$mya2)
tcomp3_mya <- table_rr(comp3_mya,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 6, outcome = 'Myasthenia Gravis',
                      e1 = comp3_mya$pre$mya1, e2 = comp3_mya$pre$mya2)

comp3_ate <- subset(comp3, !is.na(comp3$ate1))
comp3_ate <- rr(comp3_ate,e1 = comp3_ate$ate1, e2=comp3_ate$ate2)
tcomp3_ate <- table_rr(comp3_ate,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Atelectasia',
                      e1 = comp3_ate$pre$ate1, e2 = comp3_ate$pre$ate2)

comp3_arr <- subset(comp3, !is.na(comp3$arr1))
comp3_arr <- rr(comp3_arr,e1 = comp3_arr$arr1, e2=comp3_arr$arr2)
tcomp3_arr <- table_rr(comp3_arr,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Arrhythmia',
                      e1 = comp3_arr$pre$arr1, e2 = comp3_arr$pre$arr2)

comp3_winf <- subset(comp3, !is.na(comp3$winf1))
comp3_winf <- rr(comp3_winf, e1 = comp3_winf$winf1, e2=comp3_winf$winf2)
tcomp3_winf <- table_rr(comp3_winf,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 6, outcome = 'Wound Infection',
                      e1 = comp3_winf$pre$winf1, e2 = comp3_winf$pre$winf2)


comp4 <- subset(comp, versus=='Combined Transcervical-subxiphoid vs. Basic transsternal')

comp4_pn <- subset(comp4, !is.na(comp4$pn1))
comp4_pn <- rr(comp4_pn, e1 = comp4_pn$pn1, e2=comp4_pn$pn2)
tcomp4_pn <- table_rr(comp4_pn,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Pneumonia',
                      e1 = comp4_pn$pre$pn1, e2 = comp4_pn$pre$pn2)

comp4_winf <- subset(comp4, !is.na(comp4$winf1))
comp4_winf <- rr(comp4_winf, e1 = comp4_winf$winf1, e2=comp4_winf$winf2)
tcomp4_winf <- table_rr(comp4_winf,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Wound Infection',
                      e1 = comp4_winf$pre$winf1, e2 = comp4_winf$pre$winf2)



comp5 <- subset(comp, versus=='Combined Transcervical-subxiphoid vs. Extended transsternal')

comp5_pn <- subset(comp5, !is.na(comp5$pn1))
comp5_pn <- rr(comp5_pn, e1 = comp5_pn$pn1, e2=comp5_pn$pn2)
tcomp5_pn <- table_rr(comp5_pn,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Pneumonia',
                      e1 = comp5_pn$pre$pn1, e2 = comp5_pn$pre$pn2)

comp5_winf <- subset(comp5, !is.na(comp5$winf1))
comp5_winf <- rr(comp5_winf, e1 = comp5_winf$winf1, e2=comp5_winf$winf2)
tcomp5_winf <- table_rr(comp5_winf,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Wound Infection',
                      e1 = comp5_winf$pre$winf1, e2 = comp5_winf$pre$winf2)



comp$intgroup[comp$intgroup == "MINIMAL INVASIVE"] <- "Minimally invasive"
comp$intgroup[comp$intgroup == "MEDIAN STERNOTOMY APPROACH"] <- "Median sternotomy"

comp$compgroup[comp$compgroup == "MINIMAL INVASIVE"] <- "Minimally invasive"
comp$compgroup[comp$compgroup == "MEDIAN STERNOTOMY APPROACH"] <- "Median sternotomy"

comp$vsgroup <- paste0(comp$intgroup, ' vs. ', comp$compgroup)


minst <- subset(comp, vsgroup=='Minimally invasive vs. Median sternotomy')
rownames(minst) <- NULL
minst <- minst[c(1:6, 8),]
rownames(minst) <- NULL

minst_pn <- subset(minst, !is.na(minst$pn1))
minst_pn <- rr(minst_pn, e1 = minst_pn$pn1, e2=minst_pn$pn2)
tminst_pn <- table_rr(minst_pn,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 3, outcome = 'Pneumonia',
                      e1 = minst_pn$pre$pn1, e2 = minst_pn$pre$pn2)

minst_mya <- subset(minst, !is.na(minst$mya1))
minst_mya <- rr(minst_mya,e1 = minst_mya$mya1, e2=minst_mya$mya2)
tminst_mya <- table_rr(minst_mya,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 6, outcome = 'Myasthenia Gravis',
                      e1 = minst_mya$pre$mya1, e2 = minst_mya$pre$mya2)

minst_ate <- subset(minst, !is.na(minst$ate1))
minst_ate <- rr(minst_ate,e1 = minst_ate$ate1, e2=minst_ate$ate2)
tminst_ate <- table_rr(minst_ate,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Atelectasia',
                      e1 = minst_ate$pre$ate1, e2 = minst_ate$pre$ate2)

minst_arr <- subset(minst, !is.na(minst$arr1))
minst_arr <- rr(minst_arr,e1 = minst_arr$arr1, e2=minst_arr$arr2)
tminst_arr <- table_rr(minst_arr,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 1, outcome = 'Arrhythmia',
                      e1 = minst_arr$pre$arr1, e2 = minst_arr$pre$arr2)

minst_winf <- subset(minst, !is.na(minst$winf1))
minst_winf <- rr(minst_winf, e1 = minst_winf$winf1, e2=minst_winf$winf2)
tminst_winf <- table_rr(minst_winf,int = 'Intervention (n)', 
                      comp = 'Comparison (n)', nstudies = 6, outcome = 'Wound Infection',
                      e1 = minst_winf$pre$winf1, e2 = minst_winf$pre$winf2)
```





### Figure 6 
<details><summary>Click to show</summary>

*Risk of postoperative complications in patients with Myasthenia gravis undergoing thymectomy by minimally invasive vs. median sternotomy approaches*

```{r complications_overall, echo=FALSE, fig.height=10, fig.width=16, message=FALSE, warning=FALSE}

head <- c(paste0('Treatment vs. Control','\n','By Complication'), 'N of studies',
          paste0('Treatment','\n','events/n'), paste0('Control','\n','events/n'),
          'I^2', 'Relative Risk (95% CI)')

subhead1 <- c(paste0('Individual minimally invasive approaches vs. individual sternotomy approaches'), rep(NA, 5))

cp2 <- cbind(
        c('VATS extended vs. Basic transsternal', 'Wound Infection'),
        c(NA, comp2_winf$ma$k.all),
        c(NA, comp2_winf$pre$rate1),
        c(NA, comp2_winf$pre$rate2),
        c(NA, 'na'),
        c(NA, tcomp2_winf$b[[4,4]]))

cp3 <- cbind(
        c('VATS extended vs. Extended transsternal', 'Pneumonia', 'Myasthenia gravis exacerbation', 'Atelectasia',
          'Arrhythmia', 'Wound Infection'),
        c(NA, comp3_pn$ma$k.all, comp3_mya$ma$k.all, comp3_ate$ma$k.all, 
          comp3_arr$ma$k.all, comp3_winf$ma$k.all),
        c(NA, tcomp3_pn$b[[8,2]], tcomp3_mya$b[[9,2]], tcomp3_ate$b[[4,2]], 
          tcomp3_arr$b[[4,2]], tcomp3_winf$b[[7,2]]),
        c(NA, tcomp3_pn$b[[8,3]], tcomp3_mya$b[[9,3]], tcomp3_ate$b[[4,3]], 
          tcomp3_arr$b[[4,3]], tcomp3_winf$b[[7,3]]),
        c(NA, comp3_pn$ma$I2, comp3_mya$ma$I2, 'na', 
          'na', comp3_winf$ma$I2),
        c(NA, tcomp3_pn$b[[8,4]], tcomp3_mya$b[[9,4]], tcomp3_ate$b[[4,4]], 
          tcomp3_arr$b[[4,4]], tcomp3_winf$b[[7,4]]))


cp4 <- cbind(
      c('Combined Transcervical-subxiphoid vs. Basic transsternal', 'Pneumonia', 'Wound Infection'),
        c(NA, comp4_pn$ma$k.all, comp4_winf$ma$k.all),
        c(NA, tcomp4_pn$b[[4,2]], tcomp4_winf$b[[4,2]]),
        c(NA, tcomp4_pn$b[[4,3]], tcomp4_winf$b[[4,3]]),
        c(NA, 'na', 'na'),
        c(NA, tcomp4_pn$b[[4,4]], tcomp4_winf$b[[4,4]]))

cp5 <- cbind(
      c('Combined Transcervical-subxiphoid vs. Extended transsternal', 'Pneumonia', 'Wound Infection'),
        c(NA, comp5_pn$ma$k.all, comp5_winf$ma$k.all),
        c(NA, tcomp5_pn$b[[4,2]], tcomp5_winf$b[[4,2]]),
        c(NA, tcomp5_pn$b[[4,3]], tcomp5_winf$b[[4,3]]),
        c(NA, 'na', 'na'),
        c(NA, tcomp5_pn$b[[4,4]], tcomp5_winf$b[[4,4]]))



subhead2 <- c(paste0('All minimally invasive approaches pooled vs. All median sternotomy approaches pooled'), rep(NA, 5))


part1 <- cbind(
        c('Minimally invasive vs. Median sternotomy', 'Pneumonia', 'Myasthenia gravis exacerbation', 'Atelectasia',
          'Arrhythmia', 'Wound Infection'),
        c(NA, minst_pn$ma$k.all, minst_mya$ma$k.all, minst_ate$ma$k.all, 
          minst_arr$ma$k.all, minst_winf$ma$k.all),
        c(NA, tminst_pn$b[[9,2]], tminst_mya$b[[9,2]], tminst_ate$b[[4,2]], 
          tminst_arr$b[[4,2]], tminst_winf$b[[9,2]]),
        c(NA, tminst_pn$b[[9,3]], tminst_mya$b[[9,3]], tminst_ate$b[[4,3]], 
          tminst_arr$b[[4,3]], tminst_winf$b[[9,3]]),
        c(NA, minst_pn$ma$I2, minst_mya$ma$I2, 'na', 
          'na', minst_winf$ma$I2),
        c(NA, tminst_pn$b[[9,4]], tminst_mya$b[[9,4]], tminst_ate$b[[4,4]], 
          tminst_arr$b[[4,4]], tminst_winf$b[[9,4]]))



complications <- rbind(head, NA, NA, subhead1, NA, cp2, NA, cp3, NA, cp4, NA, cp5,
                       NA, NA, subhead2, NA, part1, NA)
rownames(complications) <- NULL

sub1 <- c(7, 10:14, 17, 18, 21, 22, 28:32)
complications[,1][sub1] <- paste("        ",complications[,1][sub1])

sub2 <- c(6, 9, 16, 20, 27)
complications[,1][sub2] <- paste("    ",complications[,1][sub2])


c <- rbind(NA,  NA, NA, NA, NA, NA, tcomp2_winf$c[4,], NA,
          NA, tcomp3_pn$c[8,], tcomp3_mya$c[9,], tcomp3_ate$c[4,], 
          tcomp3_arr$c[4,], tcomp3_winf$c[7,], NA,
          NA, tcomp4_pn$c[4,], tcomp4_winf$c[4,], NA,
          NA, tcomp5_pn$c[4,], tcomp5_winf$c[4,], NA,
          NA, NA, NA, NA, tminst_pn$c[9,], tminst_mya$c[9,], tminst_ate$c[4,], 
          tminst_arr$c[4,], tminst_winf$c[9,], NA)

c <- structure(list(
          mean = c(c$mean),
          lower = c(c$lower),
          upper = c(c$upper)),
          .Names = c("mean", "lower", "upper"),
          row.names = c(NA, (-1L*nrow(c))),
          class = "data.frame")


forestplot(complications,
             graph.pos = 6,
             zero = 1,
             c,
             new_page = TRUE,
             colgap = unit(5, "mm"),
             hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:7), col="black")),
             lineheight=unit(0.7,'cm'),
             boxsize = 0.5,
             line.margin = 2,
             is.summary = c(T, rep(F,2), T, F, T, rep(F,2), T, rep(F,6), T, rep(F,3), T, rep(F,4),
                            T, F, T, rep(F, 6)),
             align = c('l', rep('c',4), 'l'),
             ci.vertices = TRUE,
             txt_gp = fpTxtGp(label =gpar (cex=0.9), 
                              ticks = gpar(cex = 0.9, fontface="bold"),
                              summary = gpar(cex = 0.9),
                              xlab = gpar(cex=0.9)),
             xticks = c(0.06, 0.25,0.5,2,4,16),
             xlog=TRUE,
             clip = c(0.2, 16),
             grid = c(0.06, 0.25,0.5,2,4,16),
             lwd.xaxis = 1,
             lwd.ci = 2.2,
             lwd.zero = 2,
             graphwidth = unit(10,"cm"),
             col=fpColors(box="black",line="grey", zero = 'dodgerblue4', axes="grey20", summary="black"))


                              
```
</details>







## Supplementary Figures

### Extended Transsternal vs. Basic Transsternal forest plots
<details><summary> Suppl. Figure 1: Extended Transsternal vs. Basic Transsternal, risk of CSR at 3 years of follow-up </summary>
<p>

```{r forestplotma40, echo=FALSE, fig.height=3, fig.width=10, message=FALSE, warning=FALSE}
boxsize <- (0.0125*(weights(ma1)))

tfma1 <- cbind( 
  c( "Author", NA, prema1$author, 
     paste("Overall relative risk for", ma1$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma1$tau2, digits=2, format="f")), 
           ", df = ", (ma1$k - ma1$p),
           "; ", "I^2", "= ", (formatC(ma1$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma1$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma1$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema1$events1,"/",prema1$n1), 
     paste(sum(prema1$events1, na.rm=TRUE),"/", sum(prema1$n1, na.rm=TRUE))),
  
  c( "T3a", "events/n", paste(prema1$events2,"/",prema1$n2), 
     paste(sum(prema1$events2, na.rm=TRUE),"/",sum(prema1$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema1$rr, 
     paste(formatC(expma1$pred, format='f', digits =2), 
           " (",formatC(expma1$ci.lb, format='f', digits=2),
           "-", formatC(expma1$ci.ub, format='f', digits=2), ")")))


tfma1 <- as_tibble(tfma1)
tfma1 <- add_row(tfma1, .after = 4)
tfma1 <- add_row(tfma1, .after = 6)


rrsma1 <- structure(list(
  mean = c(NA, NA,  exp(prema1$yi), NA, expma1$pred, NA),
  lower = c(NA, NA,  exp(prema1$ci.lb), NA,  expma1$ci.lb, NA),
  upper = c(NA, NA, exp(prema1$ci.ub), NA, expma1$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -7L),
  class = "data.frame")


forestplot(as.matrix(tfma1),
           graph.pos = 4,
           zero=1,
           rrsma1,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1,NA),
           is.summary = c(T, T, rep(F, 3), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>


<details><summary> Suppl. Figure 2: Extended Transsternal vs. Basic Transsternal, risk of CSR at 4 years of follow-up </summary>
<p>

```{r forestplotma41, echo=FALSE, fig.height=3, fig.width=10, message=FALSE, warning=FALSE}
boxsize <- (0.0125*(weights(ma2)))

tfma2 <- cbind( 
  c( "Author", NA, prema2$author, 
     paste("Overall relative risk for", ma2$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma2$tau2, digits=2, format="f")), 
           ", df = ", (ma2$k - ma2$p),
           "; ", "I^2", "= ", (formatC(ma2$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma2$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma2$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema2$events1,"/",prema2$n1), 
     paste(sum(prema2$events1, na.rm=TRUE),"/", sum(prema2$n1, na.rm=TRUE))),
  
  c( "T3a", "events/n", paste(prema2$events2,"/",prema2$n2), 
     paste(sum(prema2$events2, na.rm=TRUE),"/",sum(prema2$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema2$rr, 
     paste(formatC(expma2$pred, format='f', digits =2), 
           " (",formatC(expma2$ci.lb, format='f', digits=2),
           "-", formatC(expma2$ci.ub, format='f', digits=2), ")")))


tfma2 <- as_tibble(tfma2)
tfma2 <- add_row(tfma2, .after = 4)
tfma2 <- add_row(tfma2, .after = 6)


rrsma2 <- structure(list(
  mean = c(NA, NA,  exp(prema2$yi), NA, expma2$pred, NA),
  lower = c(NA, NA,  exp(prema2$ci.lb), NA,  expma2$ci.lb, NA),
  upper = c(NA, NA, exp(prema2$ci.ub), NA, expma2$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -7L),
  class = "data.frame")


forestplot(as.matrix(tfma2),
           graph.pos = 4,
           zero=1,
           rrsma2,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1,NA),
           is.summary = c(T, T, rep(F, 3), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>



<details><summary> Suppl. Figure 3: Extended Transsternal vs. Basic Transsternal, risk of CSR at 4 years of follow-up </summary>
<p>

```{r forestplotma42, echo=FALSE, fig.height=3, fig.width=10, message=FALSE, warning=FALSE}
boxsize <- (0.0125*(weights(ma3)))

tfma3 <- cbind( 
  c( "Author", NA, prema3$author, 
     paste("Overall relative risk for", ma3$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma3$tau2, digits=2, format="f")), 
           ", df = ", (ma3$k - ma3$p),
           "; ", "I^2", "= ", (formatC(ma3$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma3$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma3$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema3$events1,"/",prema3$n1), 
     paste(sum(prema3$events1, na.rm=TRUE),"/", sum(prema3$n1, na.rm=TRUE))),
  
  c( "T3a", "events/n", paste(prema3$events2,"/",prema3$n2), 
     paste(sum(prema3$events2, na.rm=TRUE),"/",sum(prema3$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema3$rr, 
     paste(formatC(expma3$pred, format='f', digits =2), 
           " (",formatC(expma3$ci.lb, format='f', digits=2),
           "-", formatC(expma3$ci.ub, format='f', digits=2), ")")))


tfma3 <- as_tibble(tfma3)
tfma3 <- add_row(tfma3, .after = 4)
tfma3 <- add_row(tfma3, .after = 6)


rrsma3 <- structure(list(
  mean = c(NA, NA,  exp(prema3$yi), NA, expma3$pred, NA),
  lower = c(NA, NA,  exp(prema3$ci.lb), NA,  expma3$ci.lb, NA),
  upper = c(NA, NA, exp(prema3$ci.ub), NA, expma3$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -7L),
  class = "data.frame")


forestplot(as.matrix(tfma3),
           graph.pos = 4,
           zero=1,
           rrsma3,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1,NA),
           is.summary = c(T, T, rep(F, 3), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>



### Extended Transsternal vs. VATS extended forest plots
<details><summary> Suppl. Figure 4: Extended Transsternal vs. VATS extended, risk of CSR at 3 years of follow-up </summary>
<p>
```{r forestplotma43, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.01666667*(weights(ma8)))

tfma8 <- cbind( 
  c( "Author", NA, prema8$author, 
     paste("Overall relative risk for", ma8$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma8$tau2, digits=2, format="f")), 
           ", df = ", (ma8$k - ma8$p),
           "; ", "I^2", "= ", (formatC(ma8$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma8$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma8$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema8$events1,"/",prema8$n1), 
     paste(sum(prema8$events1, na.rm=TRUE),"/", sum(prema8$n1, na.rm=TRUE))),
  
  c( "T2a", "events/n", paste(prema8$events2,"/",prema8$n2), 
     paste(sum(prema8$events2, na.rm=TRUE),"/",sum(prema8$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema8$rr, 
     paste(formatC(expma8$pred, format='f', digits =2), 
           " (",formatC(expma8$ci.lb, format='f', digits=2),
           "-", formatC(expma8$ci.ub, format='f', digits=2), ")")))

tfma8 <- as_tibble(tfma8)
tfma8 <- add_row(tfma8, .after = 8)
tfma8 <- add_row(tfma8, .after = 10)

rrsma8 <- structure(list(
  mean = c(NA, NA,  exp(prema8$yi), NA, expma8$pred, NA),
  lower = c(NA, NA,  exp(prema8$ci.lb), NA,  expma8$ci.lb, NA),
  upper = c(NA, NA, exp(prema8$ci.ub), NA, expma8$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -11L),
  class = "data.frame")


forestplot(as.matrix(tfma8),
           graph.pos = 4,
           zero=1,
           rrsma8,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 7), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.12, 0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>


<details><summary> Suppl. Figure 5: Extended Transsternal vs. VATS extended, risk of CSR at 4 years of follow-up </summary>
<p>
```{r forestplotma44, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.01666667*(weights(ma9)))

tfma9 <- cbind( 
  c( "Author", NA, prema9$author, 
     paste("Overall relative risk for", ma9$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma9$tau2, digits=2, format="f")), 
           ", df = ", (ma9$k - ma9$p),
           "; ", "I^2", "= ", (formatC(ma9$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma9$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma9$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema9$events1,"/",prema9$n1), 
     paste(sum(prema9$events1, na.rm=TRUE),"/", sum(prema9$n1, na.rm=TRUE))),
  
  c( "T2b", "events/n", paste(prema9$events2,"/",prema9$n2), 
     paste(sum(prema9$events2, na.rm=TRUE),"/",sum(prema9$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema9$rr, 
     paste(formatC(expma9$pred, format='f', digits =2), 
           " (",formatC(expma9$ci.lb, format='f', digits=2),
           "-", formatC(expma9$ci.ub, format='f', digits=2), ")")))

tfma9 <- as_tibble(tfma9)
tfma9 <- add_row(tfma9, .after = 8)
tfma9 <- add_row(tfma9, .after = 10)

rrsma9 <- structure(list(
  mean = c(NA, NA,  exp(prema9$yi), NA, expma9$pred, NA),
  lower = c(NA, NA,  exp(prema9$ci.lb), NA,  expma9$ci.lb, NA),
  upper = c(NA, NA, exp(prema9$ci.ub), NA, expma9$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -11L),
  class = "data.frame")

forestplot(as.matrix(tfma9),
           graph.pos = 4,
           zero=1,
           rrsma9,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 7), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))

```
</p>
</details>



<details><summary> Suppl. Figure 6: Extended Transsternal vs. VATS extended, risk of CSR at 5 years of follow-up </summary>
<p>
```{r forestplotma45, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.0125*(weights(ma10)))

tfma10 <- cbind( 
  c( "Author", NA, prema10$author, 
     paste("Overall relative risk for", ma10$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma10$tau2, digits=2, format="f")), 
           ", df = ", (ma10$k - ma10$p),
           "; ", "I^2", "= ", (formatC(ma10$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma10$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma10$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema10$events1,"/",prema10$n1), 
     paste(sum(prema10$events1, na.rm=TRUE),"/", sum(prema10$n1, na.rm=TRUE))),
  
  c( "T2a", "events/n", paste(prema10$events2,"/",prema10$n2), 
     paste(sum(prema10$events2, na.rm=TRUE),"/",sum(prema10$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema10$rr, 
     paste(formatC(expma10$pred, format='f', digits =2), 
           " (",formatC(expma10$ci.lb, format='f', digits=2),
           "-", formatC(expma10$ci.ub, format='f', digits=2), ")")))

tfma10 <- as_tibble(tfma10)
tfma10 <- add_row(tfma10, .after = 7)
tfma10 <- add_row(tfma10, .after = 9)

rrsma10 <- structure(list(
  mean = c(NA, NA,  exp(prema10$yi), NA, expma10$pred, NA),
  lower = c(NA, NA,  exp(prema10$ci.lb), NA,  expma10$ci.lb, NA),
  upper = c(NA, NA, exp(prema10$ci.ub), NA, expma10$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -10L),
  class = "data.frame")

forestplot(as.matrix(tfma10),
           graph.pos = 4,
           zero=1,
           rrsma10,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 6), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>


<details><summary> Suppl. Figure 7: Extended Transsternal vs. VATS extended, risk of CSR at 6 years of follow-up </summary>
<p>
```{r forestplotma46, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.0125*(weights(ma11)))

tfma11 <- cbind( 
  c( "Author", NA, prema11$author, 
     paste("Overall relative risk for", ma11$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma11$tau2, digits=2, format="f")), 
           ", df = ", (ma11$k - ma11$p),
           "; ", "I^2", "= ", (formatC(ma11$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma11$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma11$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema11$events1,"/",prema11$n1), 
     paste(sum(prema11$events1, na.rm=TRUE),"/", sum(prema11$n1, na.rm=TRUE))),
  
  c( "T2a", "events/n", paste(prema11$events2,"/",prema11$n2), 
     paste(sum(prema11$events2, na.rm=TRUE),"/",sum(prema11$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema11$rr, 
     paste(formatC(expma11$pred, format='f', digits =2), 
           " (",formatC(expma11$ci.lb, format='f', digits=2),
           "-", formatC(expma11$ci.ub, format='f', digits=2), ")")))

tfma11 <- as_tibble(tfma11)
tfma11 <- add_row(tfma11, .after = 6)
tfma11 <- add_row(tfma11, .after = 8)

rrsma11 <- structure(list(
  mean = c(NA, NA,  exp(prema11$yi), NA, expma11$pred, NA),
  lower = c(NA, NA,  exp(prema11$ci.lb), NA,  expma11$ci.lb, NA),
  upper = c(NA, NA, exp(prema11$ci.ub), NA, expma11$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -9L),
  class = "data.frame")

forestplot(as.matrix(tfma11),
           graph.pos = 4,
           zero=1,
           rrsma11,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 5), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>

<details><summary> Suppl. Figure 8: Extended Transsternal vs. VATS extended, risk of CSR at 7 years of follow-up </summary>
<p>
```{r forestplotma47, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.0125*(weights(ma12)))

tfma12 <- cbind( 
  c( "Author", NA, prema12$author, 
     paste("Overall relative risk for", ma12$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma12$tau2, digits=2, format="f")), 
           ", df = ", (ma12$k - ma12$p),
           "; ", "I^2", "= ", (formatC(ma12$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma12$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma12$QEp, digits=3, format="f")))), 
            ")")),
  c( "T3b", "events/n", paste(prema12$events1,"/",prema12$n1), 
     paste(sum(prema12$events1, na.rm=TRUE),"/", sum(prema12$n1, na.rm=TRUE))),
  
  c( "T2a", "events/n", paste(prema12$events2,"/",prema12$n2), 
     paste(sum(prema12$events2, na.rm=TRUE),"/",sum(prema12$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema12$rr, 
     paste(formatC(expma12$pred, format='f', digits =2), 
           " (",formatC(expma12$ci.lb, format='f', digits=2),
           "-", formatC(expma12$ci.ub, format='f', digits=2), ")")))

tfma12 <- as_tibble(tfma12)
tfma12 <- add_row(tfma12, .after = 6)
tfma12 <- add_row(tfma12, .after = 8)

rrsma12 <- structure(list(
  mean = c(NA, NA,  exp(prema12$yi), NA, expma12$pred, NA),
  lower = c(NA, NA,  exp(prema12$ci.lb), NA,  expma12$ci.lb, NA),
  upper = c(NA, NA, exp(prema12$ci.ub), NA, expma12$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -9L),
  class = "data.frame")

forestplot(as.matrix(tfma12),
           graph.pos = 4,
           zero=1,
           rrsma12,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 5), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>


<details><summary> Suppl. Figure 9: Extended Transsternal vs. VATS extended, risk of CSR at 8 years of follow-up </summary>
<p>
```{r forestplotma48, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=9.5}
boxsize <- (0.0125*(weights(ma13)))

tfma13 <- cbind( 
  c( "Author", NA, prema13$author, 
     paste("Overall relative risk for", ma13$k.eff, "studies","\n", 
           "(Tau^2 = ", (formatC(ma13$tau2, digits=2, format="f")), 
           ", df = ", (ma13$k - ma13$p),
           "; ", "I^2", "= ", (formatC(ma13$I2, digits=1, format="f")),"%",
           ", p ", (ifelse(ma13$QEp < 0.001, 
                           paste("< 0.001"),
                           paste("= ", formatC(ma13$QEp, digits=3, format="f")))), 
            ")")),
  c( "VATS uni", "events/n", paste(prema13$events1,"/",prema13$n1), 
     paste(sum(prema13$events1, na.rm=TRUE),"/", sum(prema13$n1, na.rm=TRUE))),
  
  c( "ETsT", "events/n", paste(prema13$events2,"/",prema13$n2), 
     paste(sum(prema13$events2, na.rm=TRUE),"/",sum(prema13$n2, na.rm=TRUE))),
  
  c( "Relative Risk (95% CI)", NA,  prema13$rr, 
     paste(formatC(expma13$pred, format='f', digits =2), 
           " (",formatC(expma13$ci.lb, format='f', digits=2),
           "-", formatC(expma13$ci.ub, format='f', digits=2), ")")))

tfma13 <- as_tibble(tfma13)
tfma13 <- add_row(tfma13, .after = 5)
tfma13 <- add_row(tfma13, .after = 7)

rrsma13 <- structure(list(
  mean = c(NA, NA,  exp(prema13$yi), NA, expma13$pred, NA),
  lower = c(NA, NA,  exp(prema13$ci.lb), NA,  expma13$ci.lb, NA),
  upper = c(NA, NA, exp(prema13$ci.ub), NA, expma13$ci.ub, NA)),
  .Names = c("mean", "lower", "upper"),
  row.names = c(NA, -8L),
  class = "data.frame")

forestplot(as.matrix(tfma13),
           graph.pos = 4,
           zero=1,
           rrsma13,
           new_page = TRUE,
           colgap = unit(5, "mm"),
           hrzl_lines = list("3" = gpar (lwd=1, columns=c(1:5), col="black") 
           ),
           lineheight=unit(0.6,'cm'),
           line.margin = 2,
           boxsize = c(NA, NA, boxsize, NA, 1, NA),
           is.summary = c(T, T, rep(F, 4), T, F),
           align = c("l","c", "c"),
           ci.vertices = TRUE,
           txt_gp = fpTxtGp(label =gpar (cex=0.8), 
                            ticks = gpar(cex = 0.8, fontface="bold"),
                            summary = gpar(cex = 0.8),
                            xlab = gpar(cex=0.8)),
           xticks = c(0.25, 0.5, 1, 2, 4, 8),
           xlog=TRUE,
           clip = c(0.5, 4),
           lwd.xaxis = 1,
           lwd.ci = 2.2,
           graphwidth = unit(7,"cm"),
           col=fpColors(box="black",line="grey", 
                        axes="grey20", summary="black", zero="black"))
```
</p>
</details>


